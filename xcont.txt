☆ condrv(em).sys manager XCONT ☆

    Console driver (condrv.sys, condrvem.sys) の動作を制御します。


・機能

Console driver v1.09c+09 以降専用ですが、ほとんどの機能はドライバが組み込まれ
ていない場合でもエラーにせず無視するだけなので、一括処理の途中で使うことがで
きます。

引数を渡さずに起動した場合、標準入力がファイルに切り換えられているかどうかで
動作が異なります。

(1)切り換えられている場合
   標準入力の内容を XCON デバイスに出力します。
   このときに標準出力が切り換えられていたら、同じ内容を標準出力にも出力します。

(2)切り換えられていない場合
   バックログへの取り込みを行っているかを "on"/"off" で返します。


・コマンドライン引数

以下の引数を指定することができます。
大文字小文字は区別しませんが、基本的には小文字で記述して下さい。
* がつく機能を指定した場合、それより後の引数は評価されません。

    on      バックログへの取り込みを開始します。
    off     バックログへの取り込みを中断します。

    x       バッファリング停止レベルを表示します(*)。

    xon     バッファリングを再開します(停止レベルを 1 小さくします)。
    xoff    バッファリングを停止します(停止レベルを 1 大きくします)。

    k       ウィンドウキーが使用可能かを "on"/"off" で返します(*)。

    kon     ウィンドウキーを使用可能にします。
    koff    ウィンドウキーを抑制します。

    push    取り込みモードをスタック(32段)に待避します。
    pop     取り込みモードをスタックから復帰します。

    check   condrv(em).sys が組み込まれていれば 0 を、そうでなければ 1 を返し
            ます(*)。
    ver     condrv(em).sys 改造版のバージョンを表示します(*)。

    sleep   -z で組み込んだ xcont を停止させます。
    wakeup  sleep で停止した xcont の活動を再開させます。

    -f[n]   -f または -f1 でシステムステータス('!?')の表示を抑制します。
            -f0 で表示の抑制を解除します。

    -j[n]   -j または -j1 でペースト時にコード入力 LED が点灯していた場合に16
            進数字以外を無視します。
            -j0 で LED に関係なく全ての文字をペーストします。

    -l<file>
            file で指定したファイルをバックログバッファに取り込みます。
            (実際には XCON デバイスへ書き込んでいるだけです)

    -x<command> [...]
            一時的に取り込みを停止してから指定したプログラムを実行します。-x
            以降の全ての引数が参照されます。また、 -x"command argument" と記
            述するとスペース以降が削除されるので、必ずファイル名と引数は別々
            に指定して下さい。

    -z[p][,s]
            バックグラウンドプロセスとして常駐して定期的にキーセンスを行ない、
            メインスレッドでキーセンスが呼ばれない場合でも condrv(em).sys の
            操作を可能にします(*)。

            p は実行優先順位を指定します(省略時は 2)。
            s はスリープ時間を指定します(省略時は 50 =0.05秒)。

    -r      -z で組み込んだ xcont を解除します(*)。

    -v      このプログラムのバージョンを表示します(*)。
    -h      簡単な使用法を表示します(*)。


・バックグラウンド機能(-z)

この機能はバックグラウンドプロセスを登録することによって実現しているので、
CONFIG.SYS で process が設定されていなければ使用できません。

常駐時にスレッド名 'condrvd' を登録し condrv(em).sys を BG 動作対応モードに設
定します。

このスレッドはスレッド間通信による破棄要求を受け付けますが、condrv(em).sys の
内部データを元に戻さないので、常駐解除は必ず -r で行ってください。

condrv(em).sys の bg.txt も参照してください。


・終了コード

    0 : 正常終了。
    1 : condrv(em).sys が組み込まれていない。
    2 : 内部エラー(メモリ不足など)。
    3 : 引数に誤りがある。
    4 : ファイルアクセスに失敗した(-l による XCON デバイスへの出力エラー時も
        この値が返ります)。
    5 : condrv.sys は純正品である。
    6 : スタック操作のエラー(32 回以上 push したか、空のときに pop した場合)。
    7 : ファイルの実行に失敗した。
    8 : 既に常駐しているか、まだ常駐していない。
    9 : バックグラウンドプロセス関係のエラー。

-x を使った場合は実行したプログラムの終了コードをそのまま返します。


・制限

-x で終了コードが 7 だった場合、エラーメッセージを見なければ実行に失敗したエ
ラーなのか、子プロセスの終了コードそのものかの区別ができません。

既定のビルド設定では LF 改行を出力するので、環境によっては画面表示が乱れます。
その場合はシンボル __CRLF__ を定義して再アセンブルしてください。


・ライセンス
GNU General Public License version 3 or later.


・連絡先
TcbnErik / 立花@桑島技研
https://github.com/kg68k/condrv-xcont


[EOF]
